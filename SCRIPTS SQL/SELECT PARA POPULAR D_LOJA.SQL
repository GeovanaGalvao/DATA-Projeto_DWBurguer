--SCRIPT SQL
SELECT 
    CAST(LOJA.NR_LOJA AS SMALLINT) AS NR_LOJA,
    LOJA.NM_LOJA,
    CAST(LOJA.DT_INAUGURACAO AS DATE) AS DT_INAUGURACAO,

    EST.NM_ESTADO,
    EST.SG_ESTADO,
    CASE 
        WHEN EST.SG_ESTADO IN ('RS', 'PR', 'SC') THEN 'S'
        WHEN EST.SG_ESTADO IN ('SP', 'MG', 'RJ', 'ES') THEN 'SE'
        WHEN EST.SG_ESTADO IN ('MS', 'MT', 'GO', 'DF') THEN 'CO'
        WHEN EST.SG_ESTADO IN ('AC', 'RO', 'RR', 'AM', 'TO', 'PA', 'AP') THEN 'N'
        ELSE 'NE'
    END AS SG_MACRORREGIAO,

    CASE 
        WHEN EST.SG_ESTADO IN ('RS', 'PR', 'SC') THEN 'Sul'
        WHEN EST.SG_ESTADO IN ('SP', 'MG', 'RJ', 'ES') THEN 'Sudeste'
        WHEN EST.SG_ESTADO IN ('MS', 'MT', 'GO', 'DF') THEN 'Centro-Oeste'
        WHEN EST.SG_ESTADO IN ('AC', 'RO', 'RR', 'AM', 'TO', 'PA', 'AP') THEN 'Norte'
        ELSE 'Nordeste'
    END AS NM_MACRORREGIAO,
    CAST(CID.CD_CIDADE AS SMALLINT) AS CD_CIDADE,
    CID.NM_CIDADE,

    CAST(BAI.CD_BAIRRO AS INT) AS CD_BAIRRO,
    BAI.NM_BAIRRO,
    BAI.NM_ZONA_BAIRRO,

    CAST(LOGR.CD_LOGRADOURO AS INT) AS CD_LOGRADOURO,
    LOGR.NM_LOGRADOURO,

    CAST(ED.CD_LOJA_END AS INT) AS CD_LOJA_END,
    CAST(ED.NR_END AS INT) AS NR_END,
    ED.DS_COMPLEMENTO_END,
    CAST(LOGR.NR_CEP AS INT) AS NR_CEP,

    CAST(
        LOGR.NM_LOGRADOURO + ', ' +
        CAST(NR_END AS VARCHAR(10)) + ' ' +
        ISNULL(DS_COMPLEMENTO_END, '') + ' ' +
        NM_BAIRRO + ' ' +
        NM_CIDADE + '-' +
        EST.SG_ESTADO + ' CEP: ' +
        FORMAT(LOGR.NR_CEP, '00000-000')
    AS VARCHAR(200)) AS DS_ENDERECO_COMPLETO,

    CAST(ED.DT_INICIO AS DATE) AS DT_INICIO,
    CAST(ED.DT_TERMINO AS DATE) AS DT_TERMINO,

    CAST(
        CASE 
            WHEN ED.DT_TERMINO IS NULL THEN 'ATIVO' 
            ELSE 'INATIVO' 
        END AS VARCHAR(7)
    ) AS DS_STATUS_END,

		CAST(CID.NR_DDD AS TINYINT) AS NR_DDD,
	CAST(CID.CD_IBGE AS INT) AS CD_IBGE,

CASE WHEN NM_LOJA LIKE '% Prime %' THEN 'Prime'
	 WHEN NM_LOJA LIKE '% Vip %' THEN 'Vip'
	 WHEN NM_LOJA LIKE '% Top %' THEN 'Top'
	 WHEN NM_LOJA LIKE '% Gold %' THEN 'Gold'
	 ELSE 'VERIFICAR' END AS DS_CATEGORIA_LOJA

FROM STG_DB_LOJA LOJA
     JOIN STG_DB_END_LOJA ED 
     ON LOJA.NR_LOJA = ED.NR_LOJA
    JOIN STG_DB_LOGRADOURO LOGR 
     ON ED.CD_LOGRADOURO = LOGR.CD_LOGRADOURO
    JOIN STG_DB_BAIRRO BAI 
    ON BAI.CD_BAIRRO = LOGR.CD_BAIRRO
    JOIN STG_DB_CIDADE CID 
    ON CID.CD_CIDADE = BAI.CD_CIDADE
    JOIN STG_DB_ESTADO EST 
    ON EST.SG_ESTADO = CID.SG_ESTADO;
