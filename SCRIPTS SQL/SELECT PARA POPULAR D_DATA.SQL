SET LANGUAGE BRAZILIAN;
SET DATEFIRST 7;

SELECT 
    CAST(ISNULL(FORMAT(DATREF, 'yyyyMMdd'), -2) AS INT) AS SK_DATA,
    DATREF AS DT_REFERENCIA,
    CAST(YEAR(DATREF) AS SMALLINT) AS NR_ANO,
    
    CAST(
        CASE 
            WHEN DATEPART(QUARTER, DATREF) BETWEEN 1 AND 2 THEN YEAR(DATREF) * 100 + 1
            WHEN DATEPART(QUARTER, DATREF) BETWEEN 3 AND 4 THEN YEAR(DATREF) * 100 + 2
        END AS INT
    ) AS NR_ANO_SEMESTRE,

    CAST(
        CASE 
            WHEN DATEPART(QUARTER, DATREF) BETWEEN 1 AND 2 THEN 1
            WHEN DATEPART(QUARTER, DATREF) BETWEEN 3 AND 4 THEN 2
        END AS TINYINT
    ) AS NR_SEMESTRE,

    CAST(
        CASE 
            WHEN DATEPART(QUARTER, DATREF) BETWEEN 1 AND 2 THEN '1ºSemestre'
            WHEN DATEPART(QUARTER, DATREF) BETWEEN 3 AND 4 THEN '2ºSemestre'
        END AS CHAR(10)
    ) AS DS_SEMESTRE,

    CAST(
        CASE 
            WHEN DATEPART(QUARTER, DATREF) BETWEEN 1 AND 2 THEN '1ºSem'
            WHEN DATEPART(QUARTER, DATREF) BETWEEN 3 AND 4 THEN '2ºSem'
        END AS CHAR(5)
    ) AS DS_SEMESTRE_ABV,

    CAST(
        CASE 
            WHEN DATEPART(QUARTER, DATREF) BETWEEN 1 AND 2 THEN '1ºSemestre/' + CAST(YEAR(DATREF) AS VARCHAR(4))
            WHEN DATEPART(QUARTER, DATREF) BETWEEN 3 AND 4 THEN '2ºSemestre/' + CAST(YEAR(DATREF) AS VARCHAR(4))
        END AS CHAR(15)
    ) AS DS_SEMESTRE_ANO,

    CAST(
        CASE 
            WHEN DATEPART(QUARTER, DATREF) BETWEEN 1 AND 2 THEN '1ºSem/' + CAST(YEAR(DATREF) AS VARCHAR(4))
            WHEN DATEPART(QUARTER, DATREF) BETWEEN 3 AND 4 THEN '2ºSem/' + CAST(YEAR(DATREF) AS VARCHAR(4))
        END AS CHAR(10)
    ) AS DS_SEMESTRE_ANO_ABV,

    CAST(YEAR(DATREF) * 100 + DATEPART(QUARTER, DATREF) AS INT) AS NR_ANO_TRIMESTRE,
    CAST(DATEPART(QUARTER, DATREF) AS TINYINT) AS NR_TRIMESTRE,

	CAST(DATEPART(QUARTER, DATREF) AS CHAR(1)) + 'ºTrimestre' AS DS_TRIMESTRE,
	CAST(DATEPART(QUARTER, DATREF) AS CHAR(1)) + 'ºTri' AS DS_TRIMESTRE_ABV,
    CAST(CAST(DATEPART(QUARTER, DATREF) AS CHAR(1)) + 'ºTrimestre/' + CAST(YEAR(DATREF) AS VARCHAR(4)) AS CHAR(16)) AS DS_TRIMESTRE_ANO,
    CAST(CAST(DATEPART(QUARTER, DATREF) AS CHAR(1)) + 'ºTri/' + CAST(YEAR(DATREF) AS VARCHAR(6)) AS CHAR(11)) AS DS_TRIMESTRE_ANO_ABV,

    CAST(FORMAT(DATREF, 'yyyyMM') AS INT) AS NR_ANO_MES,
    CAST(DATEPART(MONTH, DATREF) AS TINYINT) AS NR_MES,
    CAST(DATENAME(MONTH, DATREF) AS VARCHAR(9)) AS DS_MES,
    CAST(DATENAME(MONTH, DATREF) AS CHAR(3)) AS DS_MES_ABV,
    CAST(DATENAME(MONTH, DATREF) + '/' + CAST(YEAR(DATREF) AS VARCHAR(4)) AS VARCHAR(14)) AS DS_MES_ANO,
    CAST(LEFT(DATENAME(MONTH, DATREF), 3) + '/' + CAST(YEAR(DATREF) AS VARCHAR(4)) AS CHAR(8)) AS DS_MES_ANO_ABV,

    CAST(DATEPART(DAY, DATREF) AS TINYINT) AS NR_DIA_MES,

    CAST(
        CASE 
            WHEN (MONTH(DATREF) = 12 AND DAY(DATREF) >= 21) OR (MONTH(DATREF) IN (1, 2)) OR (MONTH(DATREF) = 3 AND DAY(DATREF) < 20) THEN 'Verão'
            WHEN (MONTH(DATREF) = 3 AND DAY(DATREF) >= 20) OR (MONTH(DATREF) IN (4, 5)) OR (MONTH(DATREF) = 6 AND DAY(DATREF) < 21) THEN 'Outono'
            WHEN (MONTH(DATREF) = 6 AND DAY(DATREF) >= 21) OR (MONTH(DATREF) IN (7, 8)) OR (MONTH(DATREF) = 9 AND DAY(DATREF) < 23) THEN 'Inverno'
            WHEN (MONTH(DATREF) = 9 AND DAY(DATREF) >= 23) OR (MONTH(DATREF) IN (10, 11)) OR (MONTH(DATREF) = 12 AND DAY(DATREF) < 21) THEN 'Primavera'
        END AS VARCHAR(9)
    ) AS DS_ESTACAO_ANO,

    DATEPART(DAYOFYEAR, DATREF) AS TESTE,
    CAST(DATEPART(DAYOFYEAR, DATREF) AS SMALLINT) AS NR_DIA_ANO,
    CAST(DATEPART(WEEK, DATREF) AS TINYINT) AS NR_SEMANA_ANO,

    CAST(
        ISNULL(
            DATENAME(WEEKDAY, DATREF) + ', ' + DATENAME(DAY, DATREF) + ' de ' + DATENAME(MONTH, DATREF) + ' de ' + DATENAME(YEAR, DATREF),
            'NÃO INFORMADO'
        ) AS VARCHAR(50)
    ) AS DS_DATA_EXTENSO,

    CAST(
        CASE
            WHEN DATREF IS NULL THEN NULL
            WHEN FORMAT(DATREF, 'MMdd') IN ('0101','0421','0501','0907','1102','1115','1120','1225','0321') THEN 'Feriado'
            WHEN DATEPART(WEEKDAY, DATREF) IN (1, 7) THEN 'Fim de semana'
            ELSE 'Dia útil'
        END AS VARCHAR(20)
    ) AS DS_FERIADO,

    CAST(
        CASE
            WHEN DATREF IS NULL THEN NULL
            WHEN FORMAT(DATREF, 'MMdd') IN ('0101','0421','0501','0907','1102','1115','1120','1225') THEN 'Dia não útil'
            WHEN DATEPART(WEEKDAY, DATREF) IN (1, 7) THEN 'Dia não útil'
            ELSE 'Dia útil'
        END AS VARCHAR(12)
    ) AS DS_DIA_UTIL,

    CAST(DATENAME(WEEKDAY, DATREF) AS VARCHAR(13)) AS DS_DIA_SEMANA,
    CAST(DATENAME(WEEKDAY, DATREF) AS CHAR(3)) AS DS_DIA_SEMANA_ABV,

    CAST(
        CAST(DATEPART(DAY, DATREF) AS VARCHAR(2)) + ' de ' + DATENAME(MONTH, DATREF)
        AS VARCHAR(30)
    ) AS DS_DIA_MES,

    CAST(FORMAT(DATREF, 'dd/MM/yyyy') AS CHAR(10)) AS DS_DATA,
    CAST(DATEPART(WEEKDAY, DATREF) AS TINYINT) AS NR_DIA_SEMANA
FROM (
    SELECT DATREF FROM dbo.Gerar_Intervalo_de_Datas('2017-01-01', '2036-12-31')
    UNION 
    SELECT NULL AS DATREF
) AS TABELA1

ORDER BY SK_DATA;